<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Keys Sanity Check - OnePromptPortfolio V2</title>
    <style>
        body {
            font-family: 'Monaco', 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            display: inline-block;
            margin-left: 10px;
        }
        .status.pending {
            background: #ffa500;
            color: #000;
        }
        .status.success {
            background: #00ff00;
            color: #000;
        }
        .status.error {
            background: #ff0000;
            color: #fff;
        }
        .response-box {
            background: #111;
            border: 1px solid #333;
            padding: 10px;
            margin-top: 10px;
            border-radius: 3px;
            min-height: 40px;
            font-size: 12px;
        }
        .test-button {
            background: #333;
            color: #00ff00;
            border: 1px solid #555;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 3px;
            margin: 10px 0;
        }
        .test-button:hover {
            background: #555;
        }
        .test-all {
            background: #0066cc;
            color: white;
            font-weight: bold;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ API Keys Sanity Check</h1>
            <p>Testing Gemini (primary) + Anthropic (testing) for OnePromptPortfolio V2</p>
            <button class="test-button test-all" onclick="testAllProviders()">üöÄ Test AI Providers</button>
        </div>

        <div class="test-section" style="display: none;">
            <h3>üîµ OpenAI (GPT) - DISABLED <span id="openai-status" class="status error">DISABLED</span></h3>
            <div id="openai-response" class="response-box">OpenAI disabled - using Gemini as primary AI</div>
        </div>

        <div class="test-section">
            <h3>üü† Anthropic (Claude) - Testing Only <span id="anthropic-status" class="status pending">PENDING</span></h3>
            <button class="test-button" onclick="testAnthropic()">Test Anthropic (Testing)</button>
            <div id="anthropic-response" class="response-box">Waiting for test...</div>
        </div>

        <div class="test-section">
            <h3>üî¥ Google (Gemini) - PRIMARY AI <span id="gemini-status" class="status pending">PENDING</span></h3>
            <button class="test-button" onclick="testGemini()">Test Gemini (Primary)</button>
            <div id="gemini-response" class="response-box">Waiting for test...</div>
        </div>

        <div class="test-section">
            <h3>üìä Summary</h3>
            <div id="summary" class="response-box">Click "Test All Providers" to begin...</div>
        </div>
    </div>

    <script type="module">
        // Import environment variables (these should be set by Vite)
        const API_KEYS = {
            openai: import.meta.env.VITE_OPENAI_API_KEY,
            anthropic: import.meta.env.VITE_ANTHROPIC_API_KEY,
            gemini: import.meta.env.VITE_GEMINI_API_KEY
        };

        console.log('üîë API Keys loaded:', {
            gemini: API_KEYS.gemini ? '‚úÖ Present (PRIMARY)' : '‚ùå Missing', 
            anthropic: API_KEYS.anthropic ? '‚úÖ Present (TESTING)' : '‚ùå Missing'
        });

        const TEST_MESSAGE = "Hello! Please respond with exactly: 'API test successful'";
        // Use the recommended model
        const GEMINI_MODEL = {
            version: 'v1beta',
            model: 'gemini-2.5-flash',
            label: 'Gemini 2.5 Flash (recommended)'
        };

        // Test OpenAI
        window.testOpenAI = async function() {
            updateStatus('openai', 'pending', 'Testing...');
            
            if (!API_KEYS.openai || API_KEYS.openai.includes('your_')) {
                updateStatus('openai', 'error', 'Invalid API key format');
                return false;
            }

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEYS.openai}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: TEST_MESSAGE }],
                        max_tokens: 50,
                        temperature: 0
                    })
                });

                if (!response.ok) {
                    const error = await response.text();
                    updateStatus('openai', 'error', `HTTP ${response.status}: ${error}`);
                    return false;
                }

                const data = await response.json();
                const aiResponse = data.choices?.[0]?.message?.content || 'No response';
                
                updateStatus('openai', 'success', `‚úÖ SUCCESS\nResponse: "${aiResponse}"\nModel: ${data.model}\nTokens: ${data.usage?.total_tokens || 'N/A'}`);
                return true;
            } catch (error) {
                updateStatus('openai', 'error', `‚ùå ERROR: ${error.message}`);
                return false;
            }
        };

        // Test Anthropic
        window.testAnthropic = async function() {
            updateStatus('anthropic', 'pending', 'Testing...');
            
            if (!API_KEYS.anthropic || API_KEYS.anthropic.includes('your_')) {
                updateStatus('anthropic', 'error', 'Invalid API key format');
                return false;
            }

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEYS.anthropic,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-haiku-20240307',
                        max_tokens: 50,
                        messages: [{ role: 'user', content: TEST_MESSAGE }]
                    })
                });

                if (!response.ok) {
                    const error = await response.text();
                    updateStatus('anthropic', 'error', `HTTP ${response.status}: ${error}`);
                    return false;
                }

                const data = await response.json();
                const aiResponse = data.content?.[0]?.text || 'No response';
                
                updateStatus('anthropic', 'success', `‚úÖ SUCCESS\nResponse: "${aiResponse}"\nModel: ${data.model}\nTokens: ${data.usage?.input_tokens + data.usage?.output_tokens || 'N/A'}`);
                return true;
            } catch (error) {
                updateStatus('anthropic', 'error', `‚ùå ERROR: ${error.message}`);
                return false;
            }
        };

        // Test Google Gemini
        window.testGemini = async function() {
            updateStatus('gemini', 'pending', 'Testing...');

            if (!API_KEYS.gemini || API_KEYS.gemini.includes('your_')) {
                updateStatus('gemini', 'error', 'Invalid API key format');
                return { success: false, modelLabel: null };
            }

            try {
                // Use simple string content for the request
                const response = await fetch(`https://generativelanguage.googleapis.com/${GEMINI_MODEL.version}/models/${GEMINI_MODEL.model}:generateContent?key=${API_KEYS.gemini}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: TEST_MESSAGE }]
                        }],  // Proper format for Gemini API
                        generationConfig: {
                            maxOutputTokens: 50,
                            temperature: 0
                        }
                    })
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    updateStatus('gemini', 'error', `HTTP ${response.status}: ${errorBody}`);
                    return { success: false, modelLabel: GEMINI_MODEL.label };
                }

                const data = await response.json();
                // The response should have a text property
                const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || data.text || 'No response';

                const successMessage = [
                    '‚úÖ SUCCESS',
                    `Response: "${aiResponse}"`,
                    `Model: ${GEMINI_MODEL.label}`,
                    `Tokens: ${data.usageMetadata?.totalTokenCount || 'N/A'}`,
                ].join('\n');

                updateStatus('gemini', 'success', successMessage);
                return { success: true, modelLabel: GEMINI_MODEL.label };
            } catch (error) {
                const message = error instanceof Error ? error.message : String(error);
                updateStatus('gemini', 'error', `‚ùå ERROR: ${message}`);
                return { success: false, modelLabel: GEMINI_MODEL.label };
            }
        };

        // Test all providers (Gemini primary + Anthropic for testing)
        window.testAllProviders = async function() {
            console.log('üöÄ Starting API Keys Sanity Check (Gemini + Anthropic)...');
            
            const geminiResult = await window.testGemini();
            const anthropicSuccess = await window.testAnthropic();

            const results = {
                gemini: geminiResult.success,
                anthropic: anthropicSuccess
            };

            const successCount = Object.values(results).filter(Boolean).length;
            const totalCount = Object.keys(results).length;
            
            let summary = `üìä RESULTS: ${successCount}/${totalCount} providers working\n\n`;
            
            // Show Gemini first as primary
            summary += `${results.gemini ? '‚úÖ' : '‚ùå'} Gemini (Primary${geminiResult.modelLabel ? ` ‚Äì ${geminiResult.modelLabel}` : ''}): ${results.gemini ? 'SUCCESS' : 'FAILED'}\n`;
            summary += `${results.anthropic ? '‚úÖ' : '‚ùå'} Anthropic (Testing): ${results.anthropic ? 'SUCCESS' : 'FAILED'}\n`;

            if (results.gemini) {
                summary += '\nüéâ PRIMARY AI (Gemini 2.5 Flash) is working! Your V2 terminal is ready.';
                if (!results.anthropic) {
                    summary += '\n‚ö†Ô∏è Testing AI (Anthropic) failed, but Gemini is sufficient.';
                }
            } else {
                summary += '\nüí• PRIMARY AI (Gemini 2.5 Flash) is not working. Please check your Gemini API key.';
                if (results.anthropic) {
                    summary += '\n‚úÖ Anthropic works and can be used as fallback.';
                }
            }

            updateSummary(summary);
            
            console.log('‚úÖ API Keys Sanity Check Complete!', { gemini: geminiResult.success, anthropic: anthropicSuccess });
        };

        // Helper functions
        function updateStatus(provider, status, message) {
            const statusEl = document.getElementById(`${provider}-status`);
            const responseEl = document.getElementById(`${provider}-response`);
            
            statusEl.className = `status ${status}`;
            statusEl.textContent = status.toUpperCase();
            responseEl.innerHTML = `<pre>${message}</pre>`;
        }

        function updateSummary(message) {
            document.getElementById('summary').innerHTML = `<pre>${message}</pre>`;
        }

        // Auto-test on load (optional)
        // setTimeout(() => window.testAllProviders(), 1000);
    </script>
</body>
</html>